<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pengurus Pasukan</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
</head>
<body class="p-4 bg-light">
  <div class="container">
    <h3>Panel Pengurus: <span id="namaSekolah" class="text-primary"></span></h3>
    <hr>
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item"><a class="nav-link active" data-toggle="pill" href="#pendaftaran">Daftar Atlet</a></li>
      <li class="nav-item"><a class="nav-link" data-toggle="pill" href="#senarai" onclick="muatSenarai()">Senarai Nama</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="pendaftaran">
        <form id="formDaftar" class="bg-white p-4 border rounded">
          <div class="form-group"><label>Nama Atlet</label><input type="text" id="nama" class="form-control" required></div>
          <div class="row">
            <div class="col-md-6 form-group"><label>IC</label><input type="text" id="ic" class="form-control" required></div>
            <div class="col-md-6 form-group"><label>BIB</label><input type="text" id="bib" class="form-control" required></div>
          </div>
          <div class="form-group"><label>Acara</label>
            <select id="acara" class="form-control" required>
              <option value="100M">100M</option>
              <option value="200M">200M</option>
              <option value="Lompat Jauh">Lompat Jauh</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success btn-block">Simpan Pendaftaran</button>
        </form>
      </div>

      <div class="tab-pane fade" id="senarai">
        <table class="table bg-white">
          <thead class="thead-dark"><tr><th>Nama</th><th>BIB</th><th>Acara</th></tr></thead>
          <tbody id="isiJadual"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzDd9V1HW0qJsPiiwlrFfQdGaQ_VFSwkhHhFhsSANApP6fVMdfAXQmUhNZ3ioy2xzoFqw/exec";
    const sekolah = sessionStorage.getItem("sekolah");
    document.getElementById("namaSekolah").innerText = sekolah;

    document.getElementById("formDaftar").onsubmit = async (e) => {
      e.preventDefault();
      const payload = {
        nama: document.getElementById("nama").value,
        ic: document.getElementById("ic").value,
        bib: document.getElementById("bib").value,
        acara: document.getElementById("acara").value,
        sekolah: sekolah
      };
      const res = await fetch(`${GAS_URL}?action=daftar`, { method: 'POST', body: JSON.stringify(payload) });
      const data = await res.json();
      alert(data.message);
      document.getElementById("formDaftar").reset();
    };

    async function muatSenarai() {
      const res = await fetch(`${GAS_URL}?action=getAtlet`, { method: 'POST', body: JSON.stringify({ sekolah: sekolah }) });
      const data = await res.json();
      document.getElementById("isiJadual").innerHTML = data.map(r => `<tr><td>${r[0]}</td><td>${r[2]}</td><td>${r[4]}</td></tr>`).join('');
    }
  </script>
</body>
</html>